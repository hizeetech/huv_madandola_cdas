{% extends 'base.html' %}
{% load static %}
{% load custom_filters %}

{% block title %}Home - Madandola Estate CDA{% endblock %}

{% block content %}
<div class="jumbotron">
    <h1 class="display-4">Welcome to Madandola Estate CDA!</h1>
    <p class="lead">Your community development association portal.</p>
</div>

<div class="row">
    <div class="col-md-12">
        <h2>Executive Members</h2>
        <div id="executiveMembersCarousel" class="carousel slide" data-ride="carousel">
            <div class="carousel-inner">
                {% for i in executive_members|batch:3 %}
                    <div class="carousel-item {% if forloop.first %}active{% endif %}">
                        <div class="d-flex justify-content-around">
                            {% for member in i %}
                                <div class="text-center mx-2">
                                    {% if member.image %}
                                        <img src="{{ member.image.url }}" alt="{{ member.name }}" class="rounded-circle mb-3" width="150" height="150" style="border: 3px solid #555; box-shadow: 0 0 8px rgba(0,0,0,0.4);">
                                    {% endif %}
                                    <h5 class="text-center"><b>{{ member.name }}</b></h5>
                                    <p class="text-center"><strong><b>{{ member.position }}</b></strong></p>
                                    {% if member.phone_number %}
                                        <p class="text-center"><small>Phone: {{ member.phone_number }}</small></p>
                                    {% endif %}
                                </div>
                            {% endfor %}
                        </div>
                    </div>
                {% empty %}
                    <p class="text-center">No executive members found.</p>
                {% endfor %}
            </div>
            <a class="carousel-control-prev" href="#executiveMembersCarousel" role="button" data-slide="prev">
                <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                <span class="sr-only">Previous</span>
            </a>
            <a class="carousel-control-next" href="#executiveMembersCarousel" role="button" data-slide="next">
                <span class="carousel-control-next-icon" aria-hidden="true"></span>
                <span class="sr-only">Next</span>
            </a>
        </div>
    </div>
</div>

<div class="row mt-4">
    <div class="col-md-12">
        <h2>Community Information</h2>
        {% for info in community_info %}
            <div class="card mb-2">
                <div class="card-body">
                    <h5 class="card-title">{{ info.title }}</h5>
                    <p class="card-text">{{ info.content }}</p>
                    <small class="text-muted">Published: {{ info.published_date|date:"M d, Y" }}</small>
                </div>
            </div>
        {% empty %}
            <p>No community information available.</p>
        {% endfor %}
    </div>
</div>

<h2 class="mt-4">Upcoming Events</h2>
<div class="list-group">
    {% for event in upcoming_events %}
        <a href="#" class="list-group-item list-group-item-action flex-column align-items-start">
            <div class="d-flex w-100 justify-content-between">
                <h5 class="mb-1">{{ event.title }}</h5>
                <small>{{ event.date|date:"M d, Y" }}{% if event.time %} at {{ event.time }}{% endif %}</small>
            </div>
            <p class="mb-1">{{ event.description }}</p>
            <small>{{ event.location }}</small>
        </a>
    {% empty %}
        <p>No upcoming events.</p>
    {% endfor %}
</div>

<h2 class="mt-4">Defaulters/Owing Members</h2>
<div class="alert alert-warning" role="alert">
    <p>The following members have outstanding payments. Please settle your dues to support community development.</p>
    <table class="table table-striped table-bordered">
            <thead>
                <tr>
                    <th>Name</th>
                    <th>CDA</th>
                    <th>Amount Indebted</th>
                    <th>Debt For</th>
                    <th>Status</th>
                    <th>Notes</th>
                </tr>
            </thead>
            <tbody>
                {% for defaulter in defaulters %}
                    <tr>
                        <td>{{ defaulter.name }}</td>
                        <td>{{ defaulter.cda }}</td>
                        <td>â‚¦{{ defaulter.amount_indebted }}</td>
                        <td>{{ defaulter.title_defaulted }}</td>
                        <td>{{ defaulter.status }}</td>
                        <td>{{ defaulter.notes|default:"N/A" }}</td>
                    </tr>
                {% empty %}
                    <tr>
                        <td colspan="6" class="text-center">No defaulters found.</td>
                    </tr>
                {% endfor %}
            </tbody>
        </table>
</div>

{% endblock %}